<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Versa - A/B Test Calculator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.5/jstat.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', 'Avenir', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 2rem;
      color: #111;
      font-size: 16px;
      line-height: 1.6;
    }

    h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    h1 span {
      font-weight: 800;
      color: #111;
    }

    .intro {
      max-width: 600px;
      margin-bottom: 2rem;
    }

    .input-box {
      background: #e9fce9;
      border: 2px solid #b6f1b6;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 340px;
    }

    .input-box h2 {
      margin-top: 0;
      font-size: 1.2rem;
      font-weight: 600;
      color: #111;
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-top: 0.8rem;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 0.6rem;
      font-size: 1rem;
      margin-top: 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 1.2rem;
      padding: 0.8rem;
      width: 100%;
      font-size: 1rem;
      background-color: #50c878;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a65e;
    }

    #results {
      margin-top: 2rem;
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #ddd;
      display: none;
      max-width: 700px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 0.6rem;
      text-align: center;
    }

    th {
      background-color: #f0f0f0;
    }

    .header-logo {
      font-size: 1.8rem;
      font-weight: 800;
      margin-bottom: 1rem;
    }

    .header-logo span {
      color: #111;
    }
  </style>
</head>
<body>

  <div class="header-logo">versa</div>
  <div class="intro">
    <h1>Welcome üëã to <span>versa</span> - Your All-in-One UXR & Product building tool!</h1>
    <p>Unlock the power of data-driven decisions. Whether you're testing new features, comparing versions, or just looking for clarity, versa‚Äôs intuitive calculators give you the insights you need in seconds. Dive deep, get clear answers, and make smarter choices.</p>
  </div>

  <div class="input-box">
    <h2>Which design should we use üîç?</h2>
    <label for="v1_passes">Design 1 (Successes):</label>
    <input type="number" id="v1_passes" />

    <label for="v1_total">Design 1 (Total):</label>
    <input type="number" id="v1_total" />

    <label for="v2_passes">Design 2 (Successes):</label>
    <input type="number" id="v2_passes" />

    <label for="v2_total">Design 2 (Total):</label>
    <input type="number" id="v2_total" />

    <button onclick="calculate()">Calculate</button>
  </div>

  <div id="results"></div>

  <script>
    function logFactorial(n) {
      let result = 0;
      for (let i = 2; i <= n; i++) result += Math.log(i);
      return result;
    }

    function fisherExactTest(a, b, c, d) {
      const n = a + b + c + d;
      const logP = logFactorial(a + b) + logFactorial(c + d) + logFactorial(a + c) + logFactorial(b + d)
                 - (logFactorial(a) + logFactorial(b) + logFactorial(c) + logFactorial(d) + logFactorial(n));
      return Math.exp(logP);
    }

    function calculate() {
      const v1_passes = parseInt(document.getElementById("v1_passes").value);
      const v1_total = parseInt(document.getElementById("v1_total").value);
      const v2_passes = parseInt(document.getElementById("v2_passes").value);
      const v2_total = parseInt(document.getElementById("v2_total").value);

      if (
        isNaN(v1_passes) || isNaN(v1_total) || isNaN(v2_passes) || isNaN(v2_total) ||
        v1_passes > v1_total || v2_passes > v2_total || v1_passes < 0 || v2_passes < 0
      ) {
        document.getElementById("results").style.display = "block";
        document.getElementById("results").innerHTML = "<p>Please enter valid numbers.</p>";
        return;
      }

      const a1 = v1_passes + 1, b1 = v1_total - v1_passes + 1;
      const a2 = v2_passes + 1, b2 = v2_total - v2_passes + 1;

      const sims = 100000;
      let wins = 0;
      for (let i = 0; i < sims; i++) {
        const s1 = jStat.beta.sample(a1, b1);
        const s2 = jStat.beta.sample(a2, b2);
        if (s1 > s2) wins++;
      }

      const p_dir = Math.round((wins / sims) * 100);
      const p_rev = 100 - p_dir;

      function classifyEvidence(p) {
        if (p === 50) return "No evidence (tie)";
        if (p > 50 && p <= 80) return "Weak evidence";
        if (p > 80 && p <= 95) return "Moderate evidence";
        if (p > 95 && p <= 99) return "Strong evidence";
        return "Very strong evidence";
      }

      const obs1 = Math.round((v1_passes / v1_total) * 100);
      const obs2 = Math.round((v2_passes / v2_total) * 100);
      const est1 = Math.round((a1 / (a1 + b1)) * 100);
      const est2 = Math.round((a2 / (a2 + b2)) * 100);

      const ci1_lo = Math.round(jStat.beta.inv(0.025, a1, b1) * 100);
      const ci1_hi = Math.round(jStat.beta.inv(0.975, a1, b1) * 100);
      const ci2_lo = Math.round(jStat.beta.inv(0.025, a2, b2) * 100);
      const ci2_hi = Math.round(jStat.beta.inv(0.975, a2, b2) * 100);

      const a = v1_passes, b = v1_total - v1_passes;
      const c = v2_passes, d = v2_total - v2_passes;
      const fisher_p = fisherExactTest(a, b, c, d);
      const significant = fisher_p < 0.05 ? "Yes" : "No";
      const z_score = fisher_p > 0 ? Math.round(jStat.normal.inv(1 - fisher_p / 2, 0, 1) * 1000) / 1000 : "N/A";

      const html = `
        <table>
          <tr><th>Variant</th><th>Observed P</th><th>Best Estimate P</th><th>CI Lower</th><th>CI Upper</th></tr>
          <tr><td>Design 1</td><td>${obs1}%</td><td>${est1}%</td><td>${ci1_lo}%</td><td>${ci1_hi}%</td></tr>
          <tr><td>Design 2</td><td>${obs2}%</td><td>${est2}%</td><td>${ci2_lo}%</td><td>${ci2_hi}%</td></tr>
        </table>

        <table>
          <tr><th>Metric</th><th>Design 1 > 2</th><th>Design 2 > 1</th></tr>
          <tr><td>P-Direction</td><td>${p_dir}%</td><td>${p_rev}%</td></tr>
          <tr><td>Evidence</td><td>${classifyEvidence(p_dir)}</td><td>${classifyEvidence(p_rev)}</td></tr>
        </table>

        <table>
          <tr><th>Statistical Test</th><th>Value</th></tr>
          <tr><td>Fisher‚Äôs Exact P</td><td>${fisher_p.toFixed(5)}</td></tr>
          <tr><td>Statistically Significant?</td><td>${significant}</td></tr>
          <tr><td>Z-Score</td><td>${z_score}</td></tr>
        </table>
      `;

      const results = document.getElementById("results");
      results.style.display = "block";
      results.innerHTML = html;
    }
  </script>
</body>
</html>
